# The Aichemist Codex - Project Restructuring Plan

## Phase 1: Foundation Restructuring (Immediate Focus)

### 1. Adopt `src` Layout

- **Why**: Prevents packaging issues and ensures code behaves consistently
- **Priority**: HIGHEST - Fundamental structural change that will affect all
  other work
- **Tasks**:
  - [x] Create `src/the_aichemist_codex` directory structure
  - [x] Move backend modules into this structure
  - [ ] Update imports to use absolute paths
  - [x] Configure `pyproject.toml` for src layout
  - [ ] Fix broken tests and imports after migration
  - [ ] Create initial CI pipeline to validate the new structure

### 2. Modernize Package Management

- **Why**: Supports the src layout and establishes modern dependencies
- **Priority**: HIGH - Direct complement to src layout migration
- **Tasks**:
  - [x] Configure `pyproject.toml` for package management
  - [x] Set up UV for dependency management
  - [x] Define development vs. production dependencies
  - [x] Create configuration for managing file locking issues on Windows
  - [ ] Implement comprehensive dependency documentation

### 3. Standardize Data Directory

- **Why**: Resolves confusion about data storage locations and supports current
  file tracking/versioning work
- **Priority**: HIGH - Directly supports current Phase 2 focus areas
- **Tasks**:
  - [x] Implement centralized data directory discovery in `settings.py`
  - [x] Create DirectoryManager for standardized directory access
  - [x] Add environment variable support for data directory override
  - [x] Establish standard subdirectories (cache, logs, exports, etc.)
  - [x] Document data directory structure and purpose (in
        `data_directory_config.md` and `data_management.rst`)

## Phase 2: Code Quality Improvements (Short-Term)

### 1. Resolve Circular Dependencies

- **Why**: Improves maintainability and reduces bugs in increasingly complex
  system
- **Priority**: HIGH - Critical for system stability in current development
- **Tasks**:
  - [x] Create `fix_circular_imports.py` to identify problems
  - [ ] Apply fixes identified by the tool
  - [ ] Move shared code to `common.py` modules
  - [ ] Implement dependency injection
  - [ ] Create proper interfaces/abstract base classes
  - [x] Document solutions for circular imports in `code_maintenance.md`

### 2. Modularize Large Files

- **Why**: Improves maintainability and readability for ongoing development
- **Priority**: HIGH - Supports current work on file tracking and monitoring
- **Tasks**:
  - [ ] Split `cli.py` (104KB) into logical submodules
  - [ ] Create proper command structure
  - [ ] Consider using Typer/Click for modern CLI

### 3. Improve Configuration System

- **Why**: Safer, more flexible configuration supports new features
- **Priority**: MEDIUM - Needed for expanding format support and integrations
- **Tasks**:
  - [x] Create typed configuration schemas
  - [x] Add validation for all configuration
  - [x] Support multiple configuration sources (env vars, files)
  - [x] Document configuration in `configuration.rst`
  - [ ] Update all modules to use the new configuration system

## Phase 3: Architecture Refinement (Medium-Term)

### 1. Define Clear Service Boundaries

- **Why**: Prepares for middleware layer and API development
- **Priority**: MEDIUM - Foundation for Phase 4 API work
- **Tasks**:
  - [ ] Create service interfaces for each functional area
  - [ ] Standardize method signatures and return types
  - [ ] Add proper documentation for all public methods
  - [ ] Create dependency injection container

### 2. Add Domain Models

- **Why**: Improves code clarity and maintainability
- **Priority**: MEDIUM - Supports file relationship mapping work
- **Tasks**:
  - [ ] Create domain models for key entities (Files, Directories, Users)
  - [ ] Replace dictionary returns with proper objects
  - [ ] Add validation to models
  - [ ] Use Pydantic for data validation

### 3. Enhance Testing Infrastructure

- **Why**: Ensures reliability and prevents regressions
- **Priority**: MEDIUM - Critical but can be implemented alongside features
- **Tasks**:
  - [ ] Run tests with `python -Im pytest` in CI
  - [ ] Add integration tests for all critical flows
  - [ ] Implement property-based testing for file operations
  - [ ] Create mock file system for testing

## Phase 4: Refinement and Future-Proofing (Long-Term)

### 1. Modernize Type Annotations

- **Why**: Better static analysis and documentation
- **Priority**: MEDIUM-LOW - Incremental improvement
- **Tasks**:
  - [ ] Update to modern type annotation syntax (Python 3.10+)
  - [ ] Replace `List[T]` with `list[T]`, etc.
  - [ ] Use union syntax `X | Y` instead of `Union[X, Y]`
  - [ ] Leverage `@dataclass` for data-holding classes

### 2. Improve Documentation

- **Why**: Makes the codebase more accessible
- **Priority**: MEDIUM-LOW - Can be improved incrementally
- **Tasks**:
  - [x] Create Sphinx documentation framework
  - [x] Set up RST documentation structure
  - [ ] Add docstrings for all public methods
  - [x] Document architecture in directory_structure.rst
  - [ ] Document service interfaces
  - [x] Document data directory and configuration
  - [ ] Add usage examples

### 3. Prepare for AI Integration

- **Why**: Aligns with Phase 3 of the project roadmap
- **Priority**: MEDIUM - Future focus but requires early planning
- **Tasks**:
  - [ ] Identify integration points for ML models
  - [ ] Design plugin architecture for AI components
  - [ ] Create data processing pipelines for training
  - [ ] Implement model versioning and management

## Timeline and Priority

1. **Immediate Focus** (Next 2 Weeks):

   - Complete absolute imports update
   - Apply fixes identified by `fix_circular_imports.py`
   - Create service interfaces

2. **Short-term** (1 Month):

   - Finish remaining src layout tasks
   - Update all modules to use the new configuration system
   - Modularize large files

3. **Medium-term** (2-3 Months):

   - Add domain models
   - Add docstrings for all public methods
   - Enhance testing

4. **Long-term** (3+ Months):
   - Complete documentation
   - Middleware layer development
   - Frontend/AI integration
